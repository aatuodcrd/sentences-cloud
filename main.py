from collections import Counter
from pprint import pprint
from flask import Flask, render_template, request
from difflib import SequenceMatcher

app = Flask(__name__)

def is_similar(text1, text2, threshold=0.8):
    ratio = SequenceMatcher(None, text1, text2).ratio()
    return ratio >= threshold

def group_similar_sentences(sentences, threshold=0.8):
    grouped = []
    for sentence in sentences:
        found = False
        for group in grouped:
            if is_similar(sentence, group[0], threshold):
                group.append(sentence)
                found = True
                break
        if not found:
            grouped.append([sentence])
    return grouped

default_sentences = ['วันนี้อากาศดีมาก',
 'ฉันชอบอ่านหนังสือเกี่ยวกับปัญญาประดิษฐ์',
 'การเดินทางช่วยเปิดโลกทัศน์ของเรา',
 'เทคโนโลยีกำลังเปลี่ยนแปลงวิถีชีวิตของเรา',
 'แมวของฉันชอบนอนในที่อุ่น',
 'การเรียนรู้ไม่มีที่สิ้นสุด',
 'คุณชอบฟังเพลงประเภทไหน',
 'การออกกำลังกายทำให้ร่างกายแข็งแรง',
 'หนังสือเล่มนี้สนุกและได้ความรู้',
 'ธรรมชาติมอบความสงบและพลังใจ',
 'คุณเคยไปเที่ยวภูเขาบ้างไหม',
 'การเขียนโค้ดเป็นทักษะที่สำคัญในยุคนี้',
 'ชีวิตคือการเดินทางที่ไม่มีวันหยุด',
 'กาแฟยามเช้าทำให้ฉันรู้สึกสดชื่น',
 'ฉันกำลังเรียนรู้เกี่ยวกับการพัฒนาโมเดลปัญญาประดิษฐ์',
 'อากาศวันนี้สดชื่นมาก',
 'ฟ้าสดใสจนทำให้รู้สึกดีทั้งวัน',
 'อากาศเย็นสบายเหมาะกับการออกไปเดินเล่น',
 'วันนี้ไม่มีฝนและอากาศก็ดีมาก',
 'แดดอ่อนๆ และลมเย็นทำให้อารมณ์ดี',
 'หนังสือเกี่ยวกับ AI เป็นสิ่งที่ฉันโปรดปราน',
 'ฉันสนใจเรื่องปัญญาประดิษฐ์และหาหนังสือมาอ่านบ่อยๆ',
 'การอ่านหนังสือ AI ทำให้ฉันเข้าใจเทคโนโลยีมากขึ้น',
 'ปัญญาประดิษฐ์เป็นหัวข้อที่ฉันชอบศึกษา',
 'ฉันมักจะเลือกหนังสือที่เกี่ยวกับ AI มาอ่านเสมอ',
 'การเดินทางทำให้เราเห็นมุมมองใหม่ๆ',
 'การไปสถานที่ใหม่ช่วยให้เราเรียนรู้มากขึ้น',
 'การท่องเที่ยวช่วยเพิ่มประสบการณ์ชีวิต',
 'การเดินทางไกลทำให้เราเข้าใจวัฒนธรรมอื่นๆ',
 'ทุกครั้งที่เดินทาง ฉันได้เรียนรู้อะไรใหม่ๆ',
 'เทคโนโลยีสมัยใหม่มีผลต่อชีวิตประจำวันของเรา',
 'ชีวิตของเราถูกขับเคลื่อนด้วยนวัตกรรมเทคโนโลยี',
 'เทคโนโลยีช่วยให้เราทำสิ่งต่างๆ ได้สะดวกขึ้น',
 'ยุคดิจิทัลเปลี่ยนแปลงทุกอย่างในชีวิตประจำวัน',
 'เรากำลังอยู่ในยุคที่เทคโนโลยีคือหัวใจสำคัญ',
 'แมวที่บ้านมักจะหาที่อุ่นๆ นอนเสมอ',
 'แมวของฉันชอบขดตัวอยู่บนผ้าห่ม',
 'มันชอบนอนในที่ที่แสงแดดส่องถึง',
 'เจ้าเหมียวชอบซุกตัวในมุมอุ่นๆ',
 'แมวของฉันนอนบนหมอนอุ่นทั้งวัน',
 'ไม่มีวันไหนที่เราเรียนรู้ไม่ได้',
 'การเรียนรู้เป็นกระบวนการที่ไม่เคยหยุดนิ่ง',
 'ชีวิตคือการเรียนรู้สิ่งใหม่ๆ เสมอ',
 'เราเรียนรู้ได้จากทุกสถานการณ์ในชีวิต',
 'ความรู้อยู่รอบตัวเราให้เราเรียนรู้ตลอดเวลา',
 'เพลงแนวไหนที่คุณฟังแล้วรู้สึกผ่อนคลาย',
 'คุณมีเพลงโปรดที่ชอบฟังเป็นพิเศษไหม',
 'คุณชอบฟังเพลงที่มีจังหวะแนวไหน',
 'เพลงแบบไหนที่ทำให้คุณรู้สึกมีความสุข',
 'คุณชอบฟังเพลงเก่าหรือเพลงใหม่มากกว่ากัน',
 'ออกกำลังกายช่วยให้สุขภาพดีขึ้นมาก',
 'การออกกำลังกายช่วยเพิ่มพลังงานในชีวิตประจำวัน',
 'เมื่อเราออกกำลังกาย ร่างกายจะกระปรี้กระเปร่า',
 'การเล่นกีฬาเป็นวิธีหนึ่งที่ทำให้แข็งแรง',
 'สุขภาพดีเริ่มต้นจากการออกกำลังกาย',
 'หนังสือเล่มนี้เต็มไปด้วยเนื้อหาที่น่าสนใจ',
 'ฉันชอบเนื้อหาของหนังสือเล่มนี้มาก',
 'อ่านหนังสือเล่มนี้แล้วได้ความรู้ใหม่ๆ',
 'หนังสือเล่มนี้ทั้งสนุกและให้ข้อมูลที่ดี',
 'ฉันเรียนรู้อะไรหลายอย่างจากหนังสือเล่มนี้',
 'การอยู่ใกล้ธรรมชาติทำให้ใจสงบ',
 'ธรรมชาติช่วยให้เรารู้สึกผ่อนคลาย',
 'การเดินเล่นในธรรมชาติเสริมสร้างพลังใจ',
 'ธรรมชาติเป็นที่พักพิงของจิตใจเรา',
 'อยู่กับธรรมชาติแล้วรู้สึกสดชื่นและสงบ',
 'คุณเคยปีนเขาในที่สูงๆ ไหม',
 'คุณเคยสัมผัสบรรยากาศภูเขายามเช้าไหม',
 'คุณเคยตั้งแคมป์บนภูเขาหรือยัง',
 'คุณมีประสบการณ์เดินป่าบนภูเขาไหม',
 'คุณชอบวิวภูเขาที่ปกคลุมด้วยหมอกหรือเปล่า',
 'การเขียนโปรแกรมเป็นทักษะที่จำเป็นในยุคดิจิทัล',
 'ทุกคนควรเรียนรู้การเขียนโค้ดในยุคปัจจุบัน',
 'การเขียนโค้ดช่วยเพิ่มโอกาสในสายงานเทคโนโลยี',
 'การพัฒนาโค้ดเป็นพื้นฐานสำคัญในอุตสาหกรรม IT',
 'การเขียนโปรแกรมทำให้เราแก้ปัญหาได้อย่างสร้างสรรค์',
 'ชีวิตคือการเรียนรู้และก้าวไปข้างหน้า',
 'ทุกช่วงเวลาในชีวิตคือการผจญภัยใหม่ๆ',
 'ชีวิตเปรียบเสมือนการเดินทางที่ไม่มีจุดสิ้นสุด',
 'ทุกวันคือการเดินทางของเราในเส้นทางชีวิต',
 'ชีวิตต้องเดินต่อไปแม้ว่าจะเจออุปสรรค',
 'กลิ่นกาแฟยามเช้าทำให้วันเริ่มต้นได้ดี',
 'การดื่มกาแฟตอนเช้าทำให้ฉันมีพลัง',
 'กาแฟแก้วแรกช่วยปลุกฉันให้ตื่นเต็มตา',
 'รสชาติกาแฟตอนเช้าเป็นสิ่งที่ฉันโปรดปราน',
 'กาแฟอุ่นๆ ทำให้เช้าวันใหม่สดใสขึ้น',
 'ฉันกำลังศึกษาวิธีสร้างโมเดล AI',
 'การพัฒนาโมเดล AI เป็นสิ่งที่ฉันกำลังฝึกฝน',
 'ฉันสนใจการสร้างโมเดล Machine Learning',
 'การเรียนรู้การออกแบบโมเดล AI เป็นเป้าหมายของฉัน',
 'ฉันกำลังศึกษาแนวทางใหม่ๆ ในการพัฒนา AI',
 'อากาศวันนี้สดชื่นมาก',
 'ฟ้าสดใสจนทำให้รู้สึกดีทั้งวัน',
 'อากาศเย็นสบายเหมาะกับการออกไปเดินเล่น',
 'วันนี้ไม่มีฝนและอากาศก็ดีมาก',
 'แดดอ่อนๆ และลมเย็นทำให้อารมณ์ดี',
 'หนังสือเกี่ยวกับ AI เป็นสิ่งที่ฉันโปรดปราน',
 'ฉันสนใจเรื่องปัญญาประดิษฐ์และหาหนังสือมาอ่านบ่อยๆ',
 'การอ่านหนังสือ AI ทำให้ฉันเข้าใจเทคโนโลยีมากขึ้น',
 'ปัญญาประดิษฐ์เป็นหัวข้อที่ฉันชอบศึกษา',
 'ฉันมักจะเลือกหนังสือที่เกี่ยวกับ AI มาอ่านเสมอ',
 'การเดินทางทำให้เราเห็นมุมมองใหม่ๆ',
 'การไปสถานที่ใหม่ช่วยให้เราเรียนรู้มากขึ้น',
 'การท่องเที่ยวช่วยเพิ่มประสบการณ์ชีวิต',
 'การเดินทางไกลทำให้เราเข้าใจวัฒนธรรมอื่นๆ',
 'ทุกครั้งที่เดินทาง ฉันได้เรียนรู้อะไรใหม่ๆ',
 'เทคโนโลยีสมัยใหม่มีผลต่อชีวิตประจำวันของเรา',
 'ชีวิตของเราถูกขับเคลื่อนด้วยนวัตกรรมเทคโนโลยี',
 'เทคโนโลยีช่วยให้เราทำสิ่งต่างๆ ได้สะดวกขึ้น',
 'ยุคดิจิทัลเปลี่ยนแปลงทุกอย่างในชีวิตประจำวัน',
 'เรากำลังอยู่ในยุคที่เทคโนโลยีคือหัวใจสำคัญ',
 'แมวที่บ้านมักจะหาที่อุ่นๆ นอนเสมอ',
 'แมวของฉันชอบขดตัวอยู่บนผ้าห่ม',
 'มันชอบนอนในที่ที่แสงแดดส่องถึง',
 'เจ้าเหมียวชอบซุกตัวในมุมอุ่นๆ',
 'แมวของฉันนอนบนหมอนอุ่นทั้งวัน',
 'ไม่มีวันไหนที่เราเรียนรู้ไม่ได้',
 'การเรียนรู้เป็นกระบวนการที่ไม่เคยหยุดนิ่ง',
 'ชีวิตคือการเรียนรู้สิ่งใหม่ๆ เสมอ',
 'เราเรียนรู้ได้จากทุกสถานการณ์ในชีวิต',
 'ความรู้อยู่รอบตัวเราให้เราเรียนรู้ตลอดเวลา',
 'เพลงแนวไหนที่คุณฟังแล้วรู้สึกผ่อนคลาย',
 'คุณมีเพลงโปรดที่ชอบฟังเป็นพิเศษไหม',
 'คุณชอบฟังเพลงที่มีจังหวะแนวไหน',
 'เพลงแบบไหนที่ทำให้คุณรู้สึกมีความสุข',
 'คุณชอบฟังเพลงเก่าหรือเพลงใหม่มากกว่ากัน',
 'ออกกำลังกายช่วยให้สุขภาพดีขึ้นมาก',
 'การออกกำลังกายช่วยเพิ่มพลังงานในชีวิตประจำวัน',
 'เมื่อเราออกกำลังกาย ร่างกายจะกระปรี้กระเปร่า',
 'การเล่นกีฬาเป็นวิธีหนึ่งที่ทำให้แข็งแรง',
 'สุขภาพดีเริ่มต้นจากการออกกำลังกาย',
 'หนังสือเล่มนี้เต็มไปด้วยเนื้อหาที่น่าสนใจ',
 'ฉันชอบเนื้อหาของหนังสือเล่มนี้มาก',
 'อ่านหนังสือเล่มนี้แล้วได้ความรู้ใหม่ๆ',
 'หนังสือเล่มนี้ทั้งสนุกและให้ข้อมูลที่ดี',
 'ฉันเรียนรู้อะไรหลายอย่างจากหนังสือเล่มนี้',
 'การอยู่ใกล้ธรรมชาติทำให้ใจสงบ',
 'ธรรมชาติช่วยให้เรารู้สึกผ่อนคลาย',
 'การเดินเล่นในธรรมชาติเสริมสร้างพลังใจ',
 'ธรรมชาติเป็นที่พักพิงของจิตใจเรา',
 'อยู่กับธรรมชาติแล้วรู้สึกสดชื่นและสงบ',
 'คุณเคยปีนเขาในที่สูงๆ ไหม',
 'คุณเคยสัมผัสบรรยากาศภูเขายามเช้าไหม',
 'คุณเคยตั้งแคมป์บนภูเขาหรือยัง',
 'คุณมีประสบการณ์เดินป่าบนภูเขาไหม',
 'คุณชอบวิวภูเขาที่ปกคลุมด้วยหมอกหรือเปล่า',
 'การเขียนโปรแกรมเป็นทักษะที่จำเป็นในยุคดิจิทัล',
 'ทุกคนควรเรียนรู้การเขียนโค้ดในยุคปัจจุบัน',
 'การเขียนโค้ดช่วยเพิ่มโอกาสในสายงานเทคโนโลยี',
 'การพัฒนาโค้ดเป็นพื้นฐานสำคัญในอุตสาหกรรม IT',
 'การเขียนโปรแกรมทำให้เราแก้ปัญหาได้อย่างสร้างสรรค์',
 'ชีวิตคือการเรียนรู้และก้าวไปข้างหน้า',
 'ทุกช่วงเวลาในชีวิตคือการผจญภัยใหม่ๆ',
 'ชีวิตเปรียบเสมือนการเดินทางที่ไม่มีจุดสิ้นสุด',
 'ทุกวันคือการเดินทางของเราในเส้นทางชีวิต',
 'ชีวิตต้องเดินต่อไปแม้ว่าจะเจออุปสรรค',
 'กลิ่นกาแฟยามเช้าทำให้วันเริ่มต้นได้ดี',
 'การดื่มกาแฟตอนเช้าทำให้ฉันมีพลัง',
 'กาแฟแก้วแรกช่วยปลุกฉันให้ตื่นเต็มตา',
 'รสชาติกาแฟตอนเช้าเป็นสิ่งที่ฉันโปรดปราน',
 'กาแฟอุ่นๆ ทำให้เช้าวันใหม่สดใสขึ้น',
 'ฉันกำลังศึกษาวิธีสร้างโมเดล AI',
 'การพัฒนาโมเดล AI เป็นสิ่งที่ฉันกำลังฝึกฝน',
 'ฉันสนใจการสร้างโมเดล Machine Learning',
 'การเรียนรู้การออกแบบโมเดล AI เป็นเป้าหมายของฉัน',
 'ฉันกำลังศึกษาแนวทางใหม่ๆ ในการพัฒนา AI']

@app.route("/", methods=['GET', 'POST'])
def index():
    default_threshold = 0.4

    if request.method == 'POST':
        user_sentences = request.form.get('sentences', '')
        threshold = request.form.get('threshold', default_threshold, type=float)
        
        # Process sentences
        sentences_list = [s.strip() for s in user_sentences.split('\n') if s.strip()]
        
        # Use default if no valid sentences
        if not sentences_list:
            sentences_list = default_sentences.copy()
            user_sentences = '\n'.join(default_sentences)
    else:
        sentences_list = default_sentences.copy()
        threshold = default_threshold
        user_sentences = '\n'.join(default_sentences)

    # Generate word cloud data
    grouped_sentences = group_similar_sentences(sentences_list, threshold=threshold)
    counter = Counter()
    project_data = []
    for group in grouped_sentences:
        representative_text = group[0]
        counter[representative_text] = len(group)
    
    for text, count in counter.items():
        project_data.append({"text": text, "count": count})

    return render_template("index.html", 
                         data=project_data,
                         sentences=user_sentences,
                         threshold=threshold)

if __name__ == "__main__":
    app.run(debug=True)